# 加密机
* 用于金融加解密

### 密钥
| 类型 | 加密 | 密钥输入方式 |
| :-: | - | - |
| 公钥 | 明文 | index |
| 私钥 | 密文 | 明文内容 |
| 对称密钥 | 密文 | 明文内容 |

## 物理加密机
### 说明
* 32H时1A是X，48H时1A是Y
* LMK是100个存储密钥（32位）的空间，2个空间一组密钥。index有约定俗成的用法，但不限制使用。
* RSA存放在一个21个存储密钥（32位）的空间，只存私钥。所有私钥通过LMK的一组密钥加密。
* key生成：
  * 加密机上直接操作：输入明文key，生成密文key。
  * RSA钥匙是自动生成。

### 命令
| 操作 | 命令 | 密钥输入方式 | 密钥类型(建议) | 说明 |
| :-: | - | - | - | - |
| DES加解密 | E0 | 密文 | zek | 灌密钥 |
| 3DES加解密 | E0 | 密文 | zek | 灌密钥 |
| 公钥加密(RSA) | 30 | 索引 | 17 |  |
| 私钥加密(RSA) | 3D | 索引 | 17 |  |
| 验签(RSA) | 38 | 公钥明文 | 外部公钥 |  |
| 生成PIN | BA，JG | 密文 | zpk | 帐号，密码，pinKey（目的zpk）。灌密钥。加密机没有授权 ，串口连接加密机输入acy。 |
| 生成MAC | MU | 密文 | zak | 参考（MS），参数一样。灌密钥 |

## 软件加密机
### 功能
1. 管理功能
    1. 获取公私钥对：公钥提供给加密方，私钥提供给解密方
    1. 修改密码
1. 解密
1. 加密

### 设计
数据库用Sqlite

| 接口 | uri | 密钥输入方式 |
| :-: | - | - |
| 初始化密码 | /v1/encryptor/request/password/gen | 没有则把密码返回给前端，有则提示输入密码 <br> 后端生成一个密码； 密码由UUID截取前6位生成 ，md5加密存入数据库; |
| 更改密码 | /v1/encryptor/request/password/update?initPassword=123456&newPassword=123456 | 输入初始化密码和新密码，新密码由6位字符组成 |
| 查看RSA公私钥对 | /v1/encryptor/request/key/gen?password=123456 | 没有则生成1个秘钥对，返回秘钥对 |
| 解密 |  | 根据RSA公钥和密文，解密获得明文 |

## 资料
* [金融行业密钥详解](http://bbs.chinaunix.net/thread-1572937-1-1.html)
