# 版本和发布

## 版本
### 结构(GNU)
* https://semver.org/lang/zh-CN/
* 主版本号.子版本号[.修正版本号[.编译版本号]]
* Major.Minor[.Revision[.BuildNumber]]
* 示例：1.2.1，2.0，5.0.0.13124

| 名称 | 说明 |
| :-- | -- |
| Major | 大升级。如整体架构变动，大功能新增，向后兼容性 |
| Minor | 功能新增。Major改变时会重置为0 |
| Revision | hotfix，可以是多个bug。Major或者Minor改变时会重置为0 |
| Build | 构建。如构建次数，构建时间戳等。次数可以提前准备好；时间戳无法提前准备好，且需要【构建成功后打tag，产品能动态加载版本】 |

#### 构建流程版本示例
* Revision不变情况下的build，当前版本是1.0.0

1. 提交构建，构建失败了，完整版本是1.0.0.1
1. 解决构建失败问题后，重新提交构建，完整版本是1.0.0.2
1. 提测后测试同学没通过，研发fix
1. 提交构建，完整版本是1.0.0.3【代码变了，但是Revision不能增加】

### 版本命名规范

| 项 | 示例 | 说明 |
| :-- | -- | -- |
| 编译TAG | 5.0.0.13124 | GNU |
| 主干分支 | master/dev |  从本分支发布版本 |
| 版本分支 | 1.0, 1.0.1, 21 | 子版本号，修正版本，sprint号 |
| 功能分支 | f-123, f-mall_order | f-[jira号 \| 功能说明 ] |
| hotfix分支 | ，-123, h-login_fail | h-[bug号 \| bug说明 ] |

### 阶段
* Alpha、Beta、Gamma、RC（Release Candidate）、Release

| 阶段 | 名称 | 说明 |
| :-- | -- | -- |
| α（alpha） | 内部测试版 | 初步完成的产品，通常只用于在开发者内部交流，也有很少一部分发布给专业的测试人员，一般情况下，该版本会存在较多bug，不适合普通用户使用。 |
| β（Beta）| 外部测试版 | 无严重的错误，存在一些缺陷，需要经过大规模的发布测试进一步发现、消除错一般不适合普通用户大规模安装使用。 |
| γ（Gamma）| 外部测试版 | 已经相当成熟，与正式版相差无几 |

## 环境和发布
### 环境
| 环境 | 用户 | 分支 | 说明 |
| :-- | -- | -- | -- |
| 开发 | 开发人员 | 主分支或者特定开发分支 |  |
| 测试 | 测试人员 | 主分支或者特定开发分支 |  |
| 回归 | 测试人员 | 主分支 |  |
| 预发布 | 公司内部用户 | 发布分支 | 独立环境 |
| 灰度 | 忠诚度较高的种子用户/活跃用户 | 发布分支 | 少量生产服务器 |
| 生产 | 所有用户 | 发布分支 | 全部生产服务器 |

* 互联网产品，会在生产环境上做灰度升级，替代灰度环境

## 包内容的版本规范
| 项 | Linux/Windows | 说明 |
| - | - | - |
| 包本身 | 版本文件 | 如version.h |
|  | 包版本查询接口函数 | 库信息类有版本函数, 如<Lib>Info.version() |
| 库文件 | 文件名 | 文件名含版本信息 |
|  | 文件属性 | 文件属性含版本信息，Linux没有文件属性 |
| 执行文件 | 文件属性 |  |
|  | 版本查询命令 | exe -v |

### 资料
* [版本模型和最佳实践](https://rd.wangyaqi.cn/#/dev/model)
* [灰度升级](./common/grayupgrade)
* [软件的生命周期中一般分4个版本](https://blog.51cto.com/sandshell/2162195)
* [互联网项目发布环境:测试、回归、预发布、灰度发布、上生产](https://blog.csdn.net/linsongbin1/article/details/48467711)
