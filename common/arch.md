# 架构

## 收益
1. 系统稳定和扩展，复用度高
1. 开发简单高效：提升开发效率和产品质量
1. 维护方便升级容易：提升问题定位和解决能力，降低维护成本
1. 解决
    1. “重复造轮子”和“烟囱式架构”
    1. 技术债

## 设计方案
### 目标
1. 合适匹配
1. 系统稳定性和可用性
1. 业务扩展性

### 指导思想
1. 大中台小前端
1. 通用和架构做成通用中台，分布式可扩展性的架构
1. 业务领域建模抽象，模块化组件。业务通用库和服务视公司情况是否独立出业务中台
1. 渐进式架构设计，具有快速迭代能力。解决需求和痛点
1. 不做轮子(这世界轮子太多了)，做粘合剂整合轮子：整合方案 + 轮子使用的封装 + 小工具。

### 成功三要素
> 老板支持，独立推广，分层和模块化(微内核)

### 设计
* 设计原则：简单，适用，演化

#### 概要
  1. 分层：IaaS，PaaS，SaaS
  1. 模块化
      1. 基础库，网络通讯库
      1. 业务通用库，图形处理库
  1. 约定大于配置

#### 构成
| 项 | 定义 | 说明 |
| :-: | - | - |
| 组件 | 数据和方法的封装 |  |
| 模块 | 特定业务的代码 |  |
| 微服务 | 某个系统的单一服务，无法独立使用 |  |
| 通用库 | 通用功能的封装 |  |
| 中间件 | 独立服务 |  |

#### 服务的软件架构
| 层 | 英文 | 说明 |
| :-: | - | - |
| 表示层 | Presentation |  |
| 业务层 | Business |  |
| 服务层 | Service |  |
| 持久层 | Persistence |  |
| 数据库层 | Database |  |

## 知识
### 架构
* [架构模型](http://www.ruanyifeng.com/blog/2016/09/software-architecture.html)：分层架构，事件驱动架构，微核架构，微服务架构，云架构

#### 常规
| 项 | 内容 |
| :-: | - |
| 软件架构 | 对软件系统运行时元素的抽象，软件系统可能有很多层抽象，或由多重业务流程所组成，每层抽象或每个业务流程都有自己的软件架构。 |
| 系统架构 | 业务及其部署 |

* 架构视图: [分类1](https://juejin.cn/post/6844903588511088653), [分类2](https://blog.csdn.net/xuwei198603/article/details/46454321)

| 视图 | 类型 | 内容 | 目标 |
| :-: | - | - | - |
| 逻辑架构 | 软件架构 | 逻辑元素组成和关系，逻辑元素可以是逻辑层、功能子系统、模块。别名有应用架构和系统架构 | 明确元素及其关系 |
| 技术架构 | 软件架构 | 分层 | 技术 |
| 运行架构 | 软件架构 |  | 解决运行中的问题，如并发 |
| 物理架构 | 系统架构 | 网络、服务器等设施和软件的部署架构 | 高性能、可伸缩性、易维护性，监控 |
| 数据架构 | 系统架构 | 基于数据的设施和软件的部署架构 | 高性能、高可用性、灾备 |

#### TOGAF企业架构
* [TOGAF企业架构](https://zhuanlan.zhihu.com/p/442963069)有4种：业务架构、数据架构、应用架构、技术架构
* [资料](https://segmentfault.com/a/1190000019704801)

### 重构
* 随着业务快速迭代，重构是个正常需求。
* 重构是经常性做的，不是攒到某一刻动大手术，甚至推翻重做，那就不叫重构了。
* 团队需要日常做代码质量检查: 做Bug分析、非模板性和公共类库代码检查，以发现代码腐烂程度，哪些代码没有做很好的架构与精心的代码设计。

| 重构项 | 重构原因 | 说明 |
| :-: | - | - |
| 代码 | 代码质量差 | 做好团队研发能力建设 |
| 业务 | 业务有大变动，当前产品无法支持 | 好的业务架构可以支持的更久 |
| 架构 | 技术架构无法支持大流量等 | 好的技术架构可以支持的更久 |
| 团队 | 团队不行 | 做好团队建设 |

### 架构进化
* 同自然界一样，感知变化并适应之，不断强化优势项
* 通过模块化解耦各模块，降低进化成本
* 每次功能调整和重构都是进化

### 资料
* [亚马逊 CTO 的“中台论”](https://www.infoq.cn/article/SgOOkOhsQBcdkDDEIASg)
* [架构师](https://rd.wangyaqi.cn/#/hire/material/architect)
* [开发文档编写](https://tech.wangyaqi.cn/#/doc/dev)
* [中台团队](https://rd.wangyaqi.cn/#/hire/material/zt)
* [开放组体系结构框架TOGAF](https://zhuanlan.zhihu.com/p/47939015): 开发企业架构（Enterprise Architecture）的一套方法和工具。企业架构是承接企业业务战略与 IT战略之间的桥梁与标准接口，是企业信息化规划的核心。

### IaaS/PaaS/SaaS
![IaaSPaaSSaaS](https://pic4.zhimg.com/80/v2-1a82f8a4997b0ba53d801639d4c6706e_hd.jpg)
* Application: CRM
* Data: data from the application - stored in files, SQL server, etc.
* Runtime: .NET and Java
* Middleware: TCP/IP, ODBC connection, etc
* O/S: Windows 2012

### 微服务
* [微服务架构](https://developer.51cto.com/article/579943.html)

### 字节跳动
* [字节跳动基础架构技术迭代演进之路](https://www.infoq.cn/article/4DfsBVMVwhmeJN5Z7stX)，字节跳动的火山引擎
> 从技术体系上，字节的架构主要由三部分构成，存储 + 计算 + 研发体系：
在存储层面（注：这里的存储包括 HDFS、对象等经典存储系统，也包括 NoSQL、NewSQL、图数据库等系统），字节的策略是演进到分层存储的体系结构下，在统一的池化存储上构建兼容开源系统的存储产品矩阵来满足业务需求。基于池化存储的分层结构帮我们统一底层实现，将分布式的常见问题以及重要优化实施一次，benefit 所有上层系统，简化上层系统的开发，避免丰富的存储产品矩阵所带来运维复杂性；兼容开源系统的存储产品矩阵主要用来简化业务接入，提升开发效率；
从计算层面，我们在推进在线计算系统和离线计算的融合，长期来讲会将 Kubernetes 和 YARN 底层整合为一套资源调度系统，将 PaaS、FaaS、批式计算、流式计算在统一编排调度体系运行，持续推进资源利用率的提升。字节内部也在探索虚拟化和容器化的进一步融合；
从研发体系侧（字节将 RPC 框架、PaaS、智能运维、治理系统、稳定性系统、效能系统统称研发体系），字节绝大部分的业务是基于 PaaS 构建而非基于 IaaS 构建的，PaaS 化使得业务方关注的是资源而非机器，对于资源流量统一调配、环境治理系统的统一有非常重要的意义。
