# EtherCAT
> EtherCAT是标准的以太网帧，修改了数据链路层的结构使其更加符合工业应用中的实时性和一致性。EtherCAT的帧结构和Ethernet的帧结构完全兼容，通过在数据段即用户应用协议层增加了EtherCAT的对应数据。

## 区别
1. EtherCAT和Ethernet(传统以太网)
    1. 数据链路层不同
    1. EtherCAT是实时性传输，Ethernet非实时
1. EtherCAT和CAN总线
    1. EtherCAT完全兼容CanOpen协议
    1. EtherCAT突破了Can总线中对SDO的包长 的限制
    1. EtherCAT一次传输可以遍历多个节点

## 优势: 实时性与同步性
1. 数据传送是收到两帧之间的安全时间限制
1. 保证所有的节点同步触发，抖动时间达到1us

## 原理
### 传输
* 全双工传输，所有数据交互均发生在数据传输阶段
* 主站与从站数据交互方式主要是PDO(过程数据)和SDO(邮箱数据)，概念同CANOpen
    1. PDO：过程数据用来传输周期性的数据，PDO由三个数据缓冲区组成，类似于一个FIFO，从站写入第一个缓冲区，主站从第三个缓冲区读走。注意第二个缓冲区不可操作。从站发送PDO和接受PDO各自采用两个独立的数据缓冲区。有同步管理器来控制缓冲区，每一个同步管理器只负责一种功能，例如同步管理器2负责发送PDO，同步管理器3负责接受PDO。
* 拓扑结构灵活，几乎支持任何一种的拓扑结构，数据帧的传输方向完全由拓扑结构来决定。
* 传输机制：每一帧数据包由主站发出后依次经过各个从站，在经过各个从站同时进行数据交换，几乎没有任何延时即可遍历一个节点
### 寻址方式（主站寻址从站）
* 逻辑寻址：主站将每个从站的地址映射到一个虚拟的缓存区进行寻址。逻辑寻址的管理有从站的FMMU进行管理，FMMU将本地内存映射到主机设置的内存中的一块区域中。主站可以通过逻辑地址方便的读取任意从站的内存。
* 顺序寻址：主站按照物理连接的先后顺序进行寻址，一般用在主机刚刚启动时。
* 设置寻址：主站按照设置给每个从站的地址进行寻址。

### 从站的运行模式
1. 自由运行：由从站自主控制运行周期，一般用于开机初始化过程中，主要完成一些初始化工作和状态机的切换。
1. DC同步：受DC同步信号的控制，DC触发的周期由主站设置，DC的脉冲宽度可以在XML文件configdata中进行设置。DC模式可以保证从站设备节点的一致性，因为分布时钟是严格保持一致的。DC模式下可产生两个中断信号sync0、sync1，均可单独配置。DC中断可以用来传输周期性传输PDO数据或者周期性进行数据采集。
1. SM同步：SM中断发生于有输入输出时间发生时，即当主站想从站发送数据或请求时会触发事件中断，可以保证及时响应主站的请求和命令。
